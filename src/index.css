@tailwind base;
@tailwind components;
@tailwind utilities;

/* Full-screen layout: Disable page-level scrolling */
html, body, #root {
  height: 100%;
  margin: 0;
  padding: 0;
}

body {
  overflow: hidden; /* Locked web app - no page scrolling */
  font-family: var(--font-body);
  font-size: var(--font-body);
  line-height: 1.5;
}

/* Professional Customer Support Hub Design System 
Inspired by modern support platforms like Intercom, Zendesk
All colors MUST be HSL.
Optimized for accessibility with WCAG AA compliance.
*/

/* Screen reader only content */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

@layer base {
  :root {
    /* Base colors - Pure white for clean, professional appearance */
    --background: 0 0% 100%; /* Pure white for main background */
    --foreground: 224 71% 4%;
    
    /* Card colors - Pure white for cards */
    --card: 0 0% 100%; /* Pure white for cards */
    --card-foreground: 224 71% 4%;

    /* Popover and modal colors */
    --popover: 0 0% 100%; /* #FFFFFF */
    --popover-foreground: 224 71% 4%;

    /* Primary brand - Professional purple */
    --primary: 247 63% 59%; /* #6656D9 - Brand purple */
    --primary-foreground: 0 0% 100%; /* White */
    --primary-hover: 247 63% 55%;
    --primary-muted: 247 63% 97%; /* Very light purple */

    /* Secondary - Subtle gray for secondary actions */
    --secondary: 220 27% 96%; /* #F1F3F7 - Subtle muted background */
    --secondary-foreground: 215 25% 35%; /* #475569 in HSL */
    --secondary-hover: 220 27% 94%;

    /* Muted colors for less important elements - Strategic use for sidebars/headers */
    --muted: 220 27% 96%; /* #F1F3F7 - For sidebars and headers */
    --muted-foreground: 215 16% 47%; /* #64748b in HSL */

    /* Accent colors for highlights and notifications */
    --accent: 252 75% 98%; /* Light purple in HSL */
    --accent-foreground: 247 63% 59%;

    /* Status colors for inbox states */
    --success: 142 76% 36%; /* #22c55e in HSL */
    --success-foreground: 0 0% 100%; /* White in HSL */
    --success-muted: 138 76% 90%; /* Light green in HSL */

    --warning: 32 95% 44%; /* #fb923c in HSL */
    --warning-foreground: 0 0% 100%; /* White in HSL */
    --warning-muted: 48 96% 89%; /* Light orange in HSL */

    --destructive: 0 84% 60%; /* #ef4444 in HSL */
    --destructive-foreground: 0 0% 100%; /* White in HSL */
    --destructive-muted: 0 86% 97%; /* Light red in HSL */

    /* Border and input colors */
    --border: 225 19% 92%; /* #E6E8EE - Subtle borders */
    --input: 225 19% 92%;
    --ring: 247 63% 59%; /* #6656D9 - Brand purple for focus rings */

    /* Inbox specific colors */
    --inbox-unread: 217 91% 60%;
    --inbox-read: 220 9% 46%;
    --inbox-selected: 217 91% 95%;
    --inbox-hover: 220 14% 96%;

    /* Channel colors */
    --channel-email: 217 91% 60%;
    --channel-facebook: 221 44% 41%;
    --channel-instagram: 329 69% 56%;
    --channel-whatsapp: 142 76% 36%;

    /* Sidebar colors - Use muted for strategic visual hierarchy */
    --sidebar: 220 27% 96%; /* #F1F3F7 - Matches muted for clean separation */
    --sidebar-foreground: 215 25% 35%; /* #475569 in HSL - Dark gray for text */
    --sidebar-primary: 247 63% 59%; /* #6656D9 - Brand purple */
    --sidebar-primary-foreground: 0 0% 100%; /* White in HSL */
    --sidebar-accent: 252 75% 98%; /* Light purple in HSL */
    --sidebar-accent-foreground: 247 63% 59%;
    --sidebar-border: 225 19% 92%; /* #E6E8EE */
    --sidebar-ring: 247 63% 59%;

    /* Shadows and effects */
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --shadow-glow: 0 0 0 3px hsl(var(--primary) / 0.1);

    /* Gradients */
    --gradient-background: linear-gradient(135deg, hsl(217 91% 60%), hsl(217 91% 55%));
    --use-gradient-background: 0;
    --gradient-primary: linear-gradient(135deg, hsl(247 63% 59%), hsl(217 91% 60%));
    --gradient-surface: linear-gradient(135deg, hsl(0 0% 100%), hsl(220 14% 98%));
    --gradient-auth-bg: linear-gradient(135deg, hsl(247 80% 98%), hsl(217 91% 98%));
    --gradient-animated: linear-gradient(135deg, hsl(247 63% 59%), hsl(217 91% 60%), hsl(247 63% 59%));

    /* Typography scale */
    --font-size-xs: 0.75rem;
    --font-size-sm: 0.875rem;
    --font-size-base: 1rem;
    --font-size-lg: 1.125rem;
    --font-size-xl: 1.25rem;
    --font-size-2xl: 1.5rem;
    --font-size-3xl: 1.875rem;

    /* Spacing scale for consistent layout */
    --space-xs: 0.25rem;
    --space-sm: 0.5rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2rem;
    --space-2xl: 3rem;

    /* Animation and transitions */
    --transition-fast: 0.15s ease-out;
    --transition-normal: 0.2s ease-out;
    --transition-slow: 0.3s ease-out;
    
    /* Glassmorphism */
    --glass-bg: hsla(0, 0%, 100%, 0.7);
    --glass-border: hsla(0, 0%, 100%, 0.3);
    --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);

    /* Responsive typography and spacing */
    --font-body: clamp(14px, 1.8vw, 16px);
    --row-h: clamp(40px, 5.2vw, 48px);
    --space-3: clamp(8px, 1.2vw, 12px);
    
    /* App shell dimensions */
    --app-header-h: 64px;

    --radius: 0.75rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;


    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;

    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;

    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;

    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;

    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;

    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 212.7 26.8% 83.9%;
    /* Dark mode sidebar colors */
    --sidebar: 224 71% 4%;
    --sidebar-foreground: 210 20% 98%;
    --sidebar-primary: 217 91% 60%;
    --sidebar-primary-foreground: 222.2 84% 4.9%;
    --sidebar-accent: 215 27.9% 16.9%;
    --sidebar-accent-foreground: 210 20% 98%;
    --sidebar-border: 215 27.9% 16.9%;
    --sidebar-ring: 217 91% 60%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    /* Ensure text is always visible */
    color: hsl(var(--foreground)) !important;
  }
  
  /* Ensure proper contrast for all text elements */
  h1, h2, h3, h4, h5, h6, p, span, div, a, button, label {
    color: inherit;
  }
  
  /* Design System Auto-Contrast - Components use design system for intelligent contrast */
  .auto-contrast {
    color: inherit;
  }
  
  /* Design System Headings */
  .design-system-heading {
    font-weight: var(--heading-font-weight, 700);
  }
  
  .design-system-heading.h1 {
    font-size: var(--heading-h1-size, 2.25rem);
  }
  
  .design-system-heading.h2 {
    font-size: var(--heading-h2-size, 1.875rem);
  }
  
  .design-system-heading.h3 {
    font-size: var(--heading-h3-size, 1.5rem);
  }
  
  /* Dynamic heading style based on design system */
  .design-system-heading.gradient {
    background: var(--gradient-primary);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    color: transparent;
  }
  
  .design-system-heading.solid {
    color: hsl(var(--heading-color));
  }
  
  /* Apply design system heading styles dynamically */
  .design-system-heading {
    transition: all 0.2s ease;
  }

  /* Email content prose styling - Consolidated and clear */
  .email-render__html-content,
  .email-render__plain-content {
    @apply prose prose-sm dark:prose-invert max-w-none;
    white-space: pre-wrap !important;
    line-height: 1.6 !important;
    margin-top: 0.25em !important;
    color: hsl(var(--foreground));
    font-size: 14px;
    overflow-wrap: anywhere;
  }

  /* Paragraph spacing - clear and consistent */
  .email-render__html-content p,
  .email-render__plain-content p {
    margin-bottom: 0.75em !important;
    line-height: 1.6;
  }

  .email-render__html-content p:last-child,
  .email-render__plain-content p:last-child {
    margin-bottom: 0;
  }

  /* Link styling */
  .email-render__html-content a,
  .email-render__plain-content a {
    color: hsl(var(--primary));
    text-decoration: underline;
    text-underline-offset: 2px;
    font-weight: 500;
    transition: color 0.2s;
  }

  .email-render__html-content a:hover,
  .email-render__plain-content a:hover {
    color: hsl(var(--primary-hover));
  }

  /* Blockquote styling - softer like HelpScout */
  .email-render__html-content blockquote,
  .email-render__plain-content blockquote {
    border-left: 3px solid hsl(var(--muted-foreground));
    background: hsl(var(--muted) / 0.12);
    padding: 0.75em 1em;
    font-style: italic;
    margin: 1em 0 !important;
    border-radius: 0 0.5rem 0.5rem 0;
    color: hsl(var(--muted-foreground));
  }

  /* List styling */
  .email-render__html-content ul,
  .email-render__html-content ol,
  .email-render__plain-content ul,
  .email-render__plain-content ol {
    margin-left: 1.5em;
    margin-bottom: 1em;
  }

  .email-render__html-content li,
  .email-render__plain-content li {
    margin-bottom: 0.35em;
  }

  /* Code blocks */
  .email-render__html-content pre,
  .email-render__plain-content pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    background: hsl(var(--muted) / 0.3);
    padding: 0.75rem;
    border-radius: 0.5rem;
    font-size: 0.9em;
  }

  /* Strong emphasis */
  .email-render__html-content strong,
  .email-render__plain-content strong {
    font-weight: 600;
    color: hsl(var(--foreground));
  }

  /* Images */
  .email-render img,
  .email-render__html-content img,
  .email-render__plain-content img { 
    max-width: 100%; 
    height: auto; 
    display: block;
    border-radius: 4px;
    margin: 0;
  }

  /* Email table rendering - Force ALL tables to full width */
  .email-render__html-content table,
  .email-render__plain-content table {
    border-collapse: collapse;
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    table-layout: auto;
  }

  /* Override ANY table with width attribute */
  .email-render__html-content table[width] {
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Override inline style widths on tables */
  .email-render__html-content table[style*="width"] {
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Override wrapper divs with fixed widths */
  .email-render__html-content div[style*="width"] {
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Remove margin/padding from top-level wrapper elements */
  .email-render__html-content > table,
  .email-render__html-content > div,
  .email-render__html-content > center {
    margin: 0 !important;
    padding: 0 !important;
  }

  /* Remove margin from first child elements */
  .email-render__html-content > *:first-child {
    margin-top: 0 !important;
  }

  /* Force minimal height and no padding on ALL table cells - override inline styles */
  .email-render__html-content td,
  .email-render__html-content th,
  .email-render__html-content td[height],
  .email-render__html-content td[style*="height"],
  .email-render__html-content td[style*="padding"],
  .email-render__html-content th[style*="padding"] {
    height: auto !important;
    min-height: 0 !important;
    padding: 0 !important;
    vertical-align: top;
    text-align: inherit;
    word-break: break-word;
  }

  .email-render__plain-content td,
  .email-render__plain-content th {
    padding: 0;
    vertical-align: top;
    text-align: inherit;
    word-break: break-word;
  }

  /* Force ALL table rows to minimal height */
  .email-render__html-content tr,
  .email-render__html-content tr[height],
  .email-render__html-content tr[style*="height"] {
    height: auto !important;
    line-height: 1.2 !important;
    vertical-align: top;
  }

  .email-render__plain-content tr {
    vertical-align: top;
  }

  /* Collapse spacer rows completely */
  .email-render__html-content tr:empty,
  .email-render__html-content td:empty {
    height: 0 !important;
    padding: 0 !important;
    line-height: 0 !important;
    font-size: 0 !important;
  }

  /* Zero out margins on ALL text elements */
  .email-render__html-content p,
  .email-render__html-content h1,
  .email-render__html-content h2,
  .email-render__html-content h3,
  .email-render__html-content h4,
  .email-render__html-content h5,
  .email-render__html-content h6,
  .email-render__html-content div {
    margin: 0 !important;
    padding: 0 !important;
  }

  /* Override inline margin/padding styles on divs */
  .email-render__html-content div[style*="padding"],
  .email-render__html-content div[style*="margin"] {
    padding: 0 !important;
    margin: 0 !important;
  }

  /* Reduce line-height throughout */
  .email-render__html-content [style*="line-height"] {
    line-height: 1.2 !important;
  }

  /* Hide spacer images (common in HTML emails) */
  .email-render__html-content img[width="1"],
  .email-render__html-content img[height="1"],
  .email-render__html-content img[src*="spacer"],
  .email-render__html-content img[src*="transparent"] {
    display: none !important;
  }

  /* Preserve thead/tbody/tfoot structure */
  .email-render__html-content thead th {
    font-weight: 600;
    background-color: hsl(var(--muted) / 0.5);
  }

  /* Common email class patterns (Oda, newsletters, etc.) */
  .email-render__html-content [class*="email-section"],
  .email-render__html-content [class*="ex-email"],
  .email-render__html-content [class*="email-header"],
  .email-render__html-content [class*="email-footer"] {
    width: 100%;
    max-width: 100%;
  }

  /* Order table styling for e-commerce emails */
  .email-render__html-content [class*="order-items"] th,
  .email-render__html-content [class*="order-items"] td,
  .email-render__html-content [class*="order-details"] th,
  .email-render__html-content [class*="order-details"] td {
    padding: 8px;
    border-bottom: 1px solid hsl(var(--border));
    text-align: left;
  }

  .email-render__html-content [class*="order-items"] th {
    font-weight: 600;
  }

  /* Center tag - force full width, don't center layout */
  .email-render__html-content center {
    text-align: left !important;
    display: block;
    width: 100% !important;
  }

  /* Font tag support for legacy emails */
  .email-render__html-content font {
    font-family: inherit;
  }

  /* Responsive tables for mobile */
  @media (max-width: 480px) {
    .email-render__html-content table,
    .email-render__plain-content table {
      display: block;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .email-render__html-content table[width="600"] {
      max-width: 100%;
    }
  }

  /* Simple CSS-based collapse system - No Radix UI */
  .message-content {
    max-height: 5000px;
    overflow: hidden;
    transition: max-height 0.2s ease-out, opacity 0.2s ease-out;
    opacity: 1;
  }

  .message-content.is-collapsed {
    max-height: 0;
    opacity: 0;
  }

  /* Disable ALL animations during bulk operations */
  .disable-animation .message-content,
  .disable-animation .message-content.is-collapsed {
    transition: none !important;
  }

  .disable-animation .message-content.is-collapsed {
    display: none !important;
    max-height: 0 !important;
    opacity: 0 !important;
  }

  .disable-animation .message-content:not(.is-collapsed) {
    max-height: none !important;
    opacity: 1 !important;
  }

}

@layer utilities {
  /* Gradient background utilities */
  .bg-gradient-custom {
    background: var(--gradient-background);
  }

  /* Modern app shell layout */
  .modern-app-shell {
    height: 100dvh;
    height: 100svh;
    min-height: 100vh;
    
    /* iOS safe areas */
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }

  /* Modern header styling */
  .modern-header {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* Modern main content area */
  .modern-main-content {
    /* Handle overflow properly */
    contain: layout style;
  }

  /* App shell layout with responsive panes */
  .app-root {
    /* iOS safe viewport with fallbacks */
    height: 100dvh;
    height: 100svh;
    min-height: 100vh;
    
    /* iOS safe areas */
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    
    display: grid;
    grid-template-rows: var(--app-header-h, 64px) 1fr;
    overflow: hidden; /* Locked screen layout */
  }

  .app-header {
    position: relative;
    z-index: 200; /* Increased to ensure header controls are always accessible */
    background: hsl(var(--background));
    border-bottom: 1px solid hsl(var(--border));
  }
  
  .app-header * {
    pointer-events: auto; /* Ensure all header elements are clickable */
  }

  .app-main {
    min-height: 0;
    min-width: 0;
    overflow: hidden; /* Individual panes handle their own scrolling */
    display: grid;
  }

  /* Desktop ≥1280px: 2 panes (List | Message/Inspector) - Nav handled by Shadcn Sidebar */
  @media (min-width: 1280px) {
    .app-main {
      height: 100%;
      grid-template-columns: var(--grid-template-desktop, minmax(380px, 420px) 1fr);
      gap: 0;
      transition: grid-template-columns 0.3s ease-in-out;
    }
    
    /* List collapsed - single pane only */
    .app-main.list-collapsed {
      grid-template-columns: 1fr;
    }
    
    /* List expanded - 2 column layout */
    .app-main.list-expanded {
      grid-template-columns: minmax(380px, 420px) 1fr;
    }
    
    .list-pane, .detail-pane { 
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      min-height: 0; /* Critical: ensures proper shrinkage */
    }
    
    /* List pane visibility controls */
    .list-pane-collapsed {
      width: 0;
      overflow: hidden;
      opacity: 0;
      transition: all 0.3s ease-in-out;
    }
    
    .list-pane {
      width: auto;
      overflow: auto;
      opacity: 1;
      transition: all 0.3s ease-in-out;
      min-height: 0; /* Critical: ensures proper shrinkage */
    }
  }

  /* Desktop Medium (1024-1279px): 2 pane layout - Nav handled by Shadcn Sidebar */
  @media (min-width: 1024px) and (max-width: 1279px) {
    .app-main { 
      grid-template-columns: minmax(350px, 400px) 1fr; 
    }
    
    .app-main.list-collapsed {
      grid-template-columns: 1fr;
    }
    
    .app-main.list-expanded {
      grid-template-columns: minmax(360px, 420px) 1fr;
    }
    
    .inspector-pane { 
      display: none; /* use drawer for inspector */
    }
  }

  /* Mobile (≤767px): Single pane with safe areas */
  @media (max-width: 767px) {
    .app-main { 
      grid-template-columns: 1fr; 
    }
    
    .nav-pane, .inspector-pane, .list-pane { 
      display: none; /* replaced by mobile UI patterns */
    }
    
    /* Safe area for bottom tabs */
    .app-main {
      padding-bottom: env(safe-area-inset-bottom, 0);
    }
    
    /* When bottom tabs are present, add extra padding */
    .has-bottom-tabs .app-main {
      padding-bottom: calc(4rem + env(safe-area-inset-bottom, 0));
    }
  }
  
  /* Tablet (768-1023px): Flexible 1-2 pane layout */
  @media (min-width: 768px) and (max-width: 1023px) {
    .app-main { 
      grid-template-columns: minmax(320px, 380px) 1fr; 
    }
    
    .app-main.list-collapsed {
      grid-template-columns: 1fr;
    }
    
    .app-main.list-expanded {
      grid-template-columns: minmax(350px, 400px) 1fr;
    }
    
    .nav-pane, .inspector-pane { 
      display: none; /* use drawers on tablet */
    }
  }

  /* Performance optimized transitions */
  .app-main {
    transition: grid-template-columns 300ms cubic-bezier(0.4, 0, 0.2, 1);
    will-change: grid-template-columns;
  }
  
  /* Prevent layout thrashing during transitions */
  .app-main.transitioning {
    contain: layout style;
  }
  
  /* Smooth drawer animations */
  .drawer {
    transition: transform 250ms cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform;
  }
  
  /* Optimized sidebar transitions */
  .sidebar {
    transition: width 300ms cubic-bezier(0.4, 0, 0.2, 1);
    will-change: width;
  }
  
  /* Accessibility and touch targets */
  @media (max-width: 767px) {
    .bottom-tabs button,
    .mobile-drawer button,
    .conversation-item {
      min-height: 44px;
      min-width: 44px;
    }
    
    /* Better tap targets for conversation list items */
    .conversation-item {
      min-height: 56px;
      padding: 12px 16px;
      touch-action: manipulation; /* Prevent double-tap zoom */
    }
    
    /* Focus indicators for touch devices */
    .conversation-item:focus-visible {
      outline: 2px solid hsl(var(--primary));
      outline-offset: 2px;
    }
  }
  
  /* Enhanced interactions for desktop */
  @media (min-width: 768px) {
    .conversation-item {
      transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }
    
    .conversation-item:hover {
      background-color: hsl(var(--inbox-hover));
      transform: translateX(2px);
      box-shadow: 0 2px 8px hsl(var(--primary) / 0.1);
    }
    
    .conversation-item:focus-visible {
      outline: 2px solid hsl(var(--primary));
      outline-offset: -2px;
      background-color: hsl(var(--inbox-selected));
    }
    
    .nav-pane .sidebar-menu-button {
      transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .nav-pane .sidebar-menu-button:hover {
      background-color: hsl(var(--sidebar-accent));
      transform: translateX(4px);
    }
    
    .nav-pane .sidebar-menu-button:focus-visible {
      outline: 2px solid hsl(var(--sidebar-ring));
      outline-offset: 2px;
    }
  }
  
  /* PHASE 3: Simplified Aircall Workspace Container - No movement, just visibility */
  #aircall-workspace-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 376px;  /* Match Aircall's default 'big' size */
    height: 666px; /* Match Aircall's default 'big' size */
    z-index: 9999;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  /* Hidden state - just hide it, don't move it */
  #aircall-workspace-container.aircall-hidden {
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
    transform: scale(0.8) translateY(20px);
  }

  /* Visible state with spring animation */
  #aircall-workspace-container.aircall-visible {
    opacity: 1;
    visibility: visible;
    pointer-events: auto !important;
    transform: scale(1) translateY(0);
  }

  /* Aircall floating button pulse animation for active calls */
  @keyframes aircall-pulse-ring {
    0% {
      box-shadow: 0 0 0 0 hsl(var(--primary) / 0.7);
    }
    70% {
      box-shadow: 0 0 0 10px hsl(var(--primary) / 0);
    }
    100% {
      box-shadow: 0 0 0 0 hsl(var(--primary) / 0);
    }
  }

  .aircall-pulse-ring {
    animation: aircall-pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  /* Responsive positioning for floating button */
  @media (max-width: 768px) {
    .aircall-float-button {
      bottom: 4rem !important;
      right: 1rem !important;
      width: 3rem !important;
      height: 3rem !important;
    }
  }

  /* Ensure the workspace div inside has proper dimensions */
  #aircall-workspace {
    width: 100%;
    height: 100%;
    position: relative;
  }

/* Ensure the iframe gets proper dimensions */
#aircall-workspace iframe {
  width: 100% !important;
  height: 100% !important;
  border: none;
  display: block !important;
  visibility: inherit; /* Inherit visibility from parent container */
}

  /* PHASE 4: Ensure all dialog elements are interactive and above Aircall */
  /* Only make overlays interactive when dialogs are open */
  [data-radix-dialog-overlay][data-state="open"] {
    pointer-events: auto !important;
    z-index: 10000; /* Above Aircall workspace (9999) */
  }
  
  [data-radix-dialog-overlay][data-state="closed"] {
    pointer-events: none !important;
    opacity: 0 !important;
    z-index: 10000;
  }
  
  [data-radix-dialog-content] {
    pointer-events: auto !important;
    z-index: 10001; /* Above Aircall workspace and overlay */
  }

  .pane, .card__body {
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    min-height: 0; /* Critical: allows proper shrinkage */
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--muted)) transparent;
  }
  
  /* Custom scrollbars for webkit browsers */
  .pane::-webkit-scrollbar,
  .card__body::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
  
  .pane::-webkit-scrollbar-track,
  .card__body::-webkit-scrollbar-track {
    background: transparent;
  }
  
  .pane::-webkit-scrollbar-thumb,
  .card__body::-webkit-scrollbar-thumb {
    background: hsl(var(--muted));
    border-radius: 3px;
  }
  
  .pane::-webkit-scrollbar-thumb:hover,
  .card__body::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--muted-foreground));
  }

  /* Inbox fit @100% - text overflow handling */
  .ellipsis { 
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
  }

  .wrap { 
    overflow-wrap: anywhere; 
    word-break: break-word; 
  }

  /* List headers stick; rows compact but readable */
  .list-pane .toolbar, 
  .list-pane thead { 
    position: sticky; 
    top: 0; 
    z-index: 1; 
  }

  .row { 
    display: flex; 
    gap: 12px; 
    align-items: center; 
    height: var(--row-h, 40px); 
  }

  /* Typical list columns - responsive flex layout */
  .col--from   { flex: 0 0 160px; min-width: 140px; }
  .col--status { flex: 0 0 90px; text-align: center; }
  .col--date   { flex: 0 0 96px; text-align: right; }
  .col--subject { flex: 1 1 auto; min-width: 0; } /* shrinks with ellipsis */
  .col--subject > span { composes: ellipsis; }

  /* Action bars must not grow the layout */
  .actions { 
    display: flex; 
    gap: 8px; 
    flex-wrap: wrap; 
  }
  .actions > .primary { white-space: nowrap; }
  .actions > .secondary { white-space: nowrap; }

  /* Legacy responsive panes - keep for backward compatibility */
  .nav-pane { 
    flex: 0 0 240px; 
  }

  .list-pane { 
    flex: 0 0 280px;
    border-right: 1px solid hsl(var(--border));
    transition: flex-basis 0.3s ease-in-out;
  }
  
  .list-pane-collapsed {
    flex: 0 0 60px;
    border-right: 1px solid hsl(var(--border));
    transition: flex-basis 0.3s ease-in-out;
  }

  .detail-pane { 
    flex: 1 1 auto;
    min-width: 400px;
  }

  /* Drawer system for mobile/tablet */
  .drawer {
    position: fixed; 
    top: 0; 
    bottom: 0; 
    width: min(88vw, 360px);
    background: hsl(var(--card)); 
    box-shadow: 0 10px 30px hsl(var(--shadow) / 0.2);
    transition: transform 0.22s ease; 
    z-index: 50; 
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  .drawer--left { 
    left: 0; 
    transform: translateX(-100%); 
  }

  .drawer--right { 
    right: 0; 
    transform: translateX(100%); 
  }

  .drawer[aria-hidden="false"] { 
    transform: translateX(0); 
  }

  .drawer-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 40;
    opacity: 0;
    transition: opacity 0.22s ease;
  }

  .drawer-overlay[aria-hidden="false"] {
    opacity: 1;
  }

  /* Accessible bottom tab bar */
  .bottom-tabs {
    position: fixed; 
    left: 0; 
    right: 0; 
    bottom: 0;
    display: grid; 
    grid-auto-flow: column; 
    gap: 8px; 
    padding: 8px;
    background: hsl(var(--card));
    border-top: 1px solid hsl(var(--border));
    backdrop-filter: blur(8px);
    z-index: 50;
  }
  
  /* Bottom tab accessibility */
  .bottom-tabs button {
    position: relative;
    border-radius: 8px;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .bottom-tabs button:focus-visible {
    outline: 2px solid hsl(var(--primary));
    outline-offset: 2px;
  }
  
  .bottom-tabs button[aria-selected="true"] {
    background: hsl(var(--primary));
    color: hsl(var(--primary-foreground));
  }
  
  .bottom-tabs button[aria-selected="true"]::after {
    content: '';
    position: absolute;
    top: -2px;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 2px;
    background: hsl(var(--primary));
    border-radius: 1px;
  }
    padding-bottom: max(8px, env(safe-area-inset-bottom));
    background: hsl(var(--card)); 
    border-top: 1px solid hsl(var(--border));
    z-index: 30;
  }

  .bottom-tabs button { 
    min-height: 44px; 
    font-size: 16px; /* avoid iOS zoom on focus */
  }

/* Responsive panel management - legacy compatibility */
@media (max-width: 1400px) {
  .list-pane {
    flex: 0 0 260px;
  }
}

@media (max-width: 1200px) {
  .list-pane {
    flex: 0 0 240px;
  }
  .detail-pane {
    min-width: 350px;
  }
}

/* Email render controls and content wrapper - lean and focused */
.email-render__controls {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  padding: 8px 0;
  border-bottom: 1px solid hsl(var(--border));
}

.email-render__content {
  position: relative;
}

/* Aggressively minimize prose spacing for email content - using @layer to avoid circular dependency */
@layer components {
  .email-render__html-content p,
  .email-render__plain-content p {
    margin-top: 0.125rem !important;
    margin-bottom: 0.125rem !important;
  }

  .email-render__html-content > *:first-child,
  .email-render__plain-content > *:first-child {
    margin-top: 0 !important;
  }

  .email-render__html-content > *:last-child,
  .email-render__plain-content > *:last-child {
    margin-bottom: 0 !important;
  }
}

/* Email content styling - consolidated from emailFormatting.ts */
.email-render__html-content,
.email-render__plain-content {
  max-width: min(100%, 900px);
  overflow-wrap: anywhere;
}

/* Force readable colors */
.email-render__html-content :not([style*="color"]):not([color]),
.email-render__plain-content :not([style*="color"]):not([color]) {
  color: inherit !important;
}

/* Mobile responsive email tables */
@media (max-width: 600px) {
  .email-render__html-content table[width="600"],
  .email-render__plain-content table[width="600"] {
    width: 100% !important;
  }
  
  .email-render__html-content .structure__table,
  .email-render__plain-content .structure__table {
    width: 100% !important;
  }
}

/* Special handling for pre and code elements - remove email client formatting */
.email-render__html-content pre,
.email-render__html-content code {
  font-family: inherit !important; /* Override monospace font */
  background-color: transparent !important; /* Remove dark background */
  color: inherit !important; /* Inherit text color */
  padding: 0 !important; /* Remove padding */
  margin: 0 !important; /* Remove margins */
  border: none !important; /* Remove any borders */
  white-space: pre-wrap !important;
  word-break: break-word;
  overflow-x: auto;
}

/* Plain Text Content - Enhanced readability */
.email-render__plain-content {
  white-space: pre-wrap;
  font-family: inherit;
  font-size: inherit;
  line-height: 1.7;
  max-width: 100%;
  min-width: 0;
  overflow-wrap: break-word;
  word-break: break-word;
}

.email-render__text-line {
  margin: 0;
  padding: 2px 0;
  font-family: inherit;
  font-size: inherit;
  line-height: 1.7;
  white-space: pre-wrap;
}

/* Actual code blocks (semantic pre+code) - enhanced styling */
.email-render__html-content pre code,
.email-render__plain-content pre code {
  font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace;
  background-color: hsl(var(--muted) / 0.5);
  padding: 12px 16px;
  border-radius: 6px;
  border: 1px solid hsl(var(--border));
  display: block;
  overflow-x: auto;
  font-size: 0.9em;
  line-height: 1.5;
}

/* Distinguish actual code blocks from plain text */
.email-render__html-content pre:has(code),
.email-render__plain-content pre:has(code) {
  background-color: hsl(var(--muted) / 0.3);
  border-radius: 8px;
  padding: 0;
  margin: 1em 0;
}

/* Email client content converted from pre tags */
.email-render__html-content .email-client-content {
  font-family: inherit;
  font-size: inherit;
  line-height: 1.6;
  color: inherit;
  background: transparent;
  margin: 0;
  padding: 0;
}

.email-render__quoted-text {
  background-color: hsl(var(--muted));
  border-left: 3px solid hsl(var(--border));
  padding: 8px 12px;
  margin: 8px 0;
  border-radius: 4px;
  font-size: 13px;
  color: hsl(var(--muted-foreground));
}

/* Collapsible Sections */
.email-render__collapsible {
  margin: 8px 0;
}

.email-render__collapsible-toggle {
  padding: 4px 8px;
  height: auto;
  border-radius: 4px;
  transition: var(--transition-smooth);
}

.email-render__collapsible-toggle:hover {
  background-color: hsl(var(--accent));
}

.email-render__collapsible-toggle:focus {
  outline: 2px solid hsl(var(--ring));
  outline-offset: 2px;
}

.email-render__collapsible-content {
  margin-top: 8px;
  animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Attachments */
.email-render__attachments {
  margin-top: 16px;
  padding-top: 12px;
  border-top: 1px solid hsl(var(--border));
}

.email-render__attachments-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 8px;
  color: hsl(var(--foreground));
}

.email-render__attachments-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.email-render__attachment-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  background-color: hsl(var(--muted) / 0.5);
  border: 1px solid hsl(var(--border));
  border-radius: 6px;
  transition: var(--transition-smooth);
}

.email-render__attachment-item:hover {
  background-color: hsl(var(--muted));
}

.email-render__attachment-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
  flex: 1;
  min-width: 0;
}

.email-render__attachment-name {
  font-size: 13px;
  font-weight: 500;
  color: hsl(var(--foreground));
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.email-render__attachment-size {
  font-size: 11px;
  color: hsl(var(--muted-foreground));
}

.email-render__attachment-actions {
  display: flex;
  gap: 4px;
}

/* Image Loading States */
.email-render img[data-blocked="true"] {
  background-color: hsl(var(--muted));
  border: 2px dashed hsl(var(--border));
  padding: 20px;
  text-align: center;
  display: block;
  font-size: 12px;
  color: hsl(var(--muted-foreground));
}

.email-render img[loading="lazy"] {
  transition: opacity 0.3s ease;
}

.email-render img[loading="lazy"]:not([src]) {
  opacity: 0.7;
}

/* Touch and accessibility */
button, input, a { 
  font-size: 16px; /* avoid iOS zoom on focus */
}

/* Minimum touch targets - exclude form control primitives */
button:not([role="checkbox"]):not([role="radio"]):not([role="switch"]), 
[role="button"], 
[role="tab"] {
  min-height: 44px;
  min-width: 44px;
}

/* Dashboard/cards pattern for responsive layout */
.dashboard { 
  height: 100%; 
  display: grid; 
  grid-template-rows: auto 1fr; 
  gap: 12px; 
  overflow: hidden; 
}

.kpi-strip { 
  display: grid; 
  grid-auto-flow: column; 
  grid-auto-columns: minmax(180px, 1fr); 
  gap: 12px; 
  overflow: hidden; 
}

.dashboard-grid {
  display: grid; 
  gap: 12px; 
  min-height: 0; 
  overflow: auto;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
}

.card { 
  display: grid; 
  grid-template-rows: auto 1fr; 
  min-height: 0; 
  max-height: clamp(300px, 40vh, 520px); 
}

.card__header { 
  position: sticky; 
  top: 0; 
  z-index: 1; 
  padding: 12px; 
  background: hsl(var(--card)); 
}

.card__body { 
  overflow: auto; 
  padding: 12px; 
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .drawer, .modal, * {
    transition: none !important;
    animation: none !important;
  }
}

/* Mobile Responsive */
@media (max-width: 600px) {
  .email-render {
    max-width: 100%;
    /* Padding handled inline in emailFormatting.ts */
  }
  
  .email-render__controls {
    flex-wrap: wrap;
  }
  
  .email-render__attachment-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
  
  .email-render__attachment-actions {
    align-self: flex-end;
  }
}

/* High Contrast Mode Support */
@media (prefers-contrast: high) {
  .email-render__quoted-text {
    border-left-width: 4px;
  }
  
  .email-render__attachment-item {
    border-width: 2px;
  }
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  .drawer, .modal, .email-render__collapsible-content, .email-render__attachment-item, .email-render__collapsible-toggle {
    transition: none !important;
    animation: none !important;
  }
}

/* Print Styles */
@media print {
  .email-render__controls {
    display: none;
  }
  
  .email-render__collapsible-content {
    display: block !important;
  }
  
  .email-render__attachment-actions {
    display: none;
  }
}

